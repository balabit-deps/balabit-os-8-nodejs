From f369c0a739b9f0182ededa834a2a44e6fec322d1 Mon Sep 17 00:00:00 2001
From: RafaelGSS <rafael.nunu@hotmail.com>
Date: Wed, 18 Jan 2023 17:37:37 -0300
Subject: [PATCH] build: build ICU with ICU_NO_USER_DATA_OVERRIDE

Refs: https://hackerone.com/bugs?subject=nodejs&report_id=1625036
CVE-ID: 2023-23920
PR-URL: https://github.com/nodejs-private/node-private/pull/374
Reviewed-by: Michael Dawson <midawson@redhat.com>
Reviewed-by: Ben Noordhuis <info@bnoordhuis.nl>
Reviewed-by: Richard Lau <rlau@redhat.com>
---
 configure.py | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/configure.py b/configure.py
index 4ebb5606be4f6..215aee5d805e4 100755
--- a/configure.py
+++ b/configure.py
@@ -1669,6 +1669,9 @@ def icu_download(path):
   # always set icu_small, node.gyp depends on it being defined.
   o['variables']['icu_small'] = b(False)
 
+  # prevent data override
+  o['defines'] += ['ICU_NO_USER_DATA_OVERRIDE']
+
   with_intl = options.with_intl
   with_icu_source = options.with_icu_source
   have_icu_path = bool(options.with_icu_path)
